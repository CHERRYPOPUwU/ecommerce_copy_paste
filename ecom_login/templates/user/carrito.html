{% extends 'base.html' %}
{% block content %}
<div class="container mt-5 mb-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold mb-2" style="background: linear-gradient(135deg, #FF6B9D 0%, #C084FC 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
      ğŸ›’ Mi Carrito de Compras
    </h1>
    <p class="text-muted">Revisa tus productos antes de finalizar</p>
  </div>

  {% if items %}
  <div class="row g-4">
    <!-- Lista de productos -->
    <div class="col-lg-8">
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-4">ğŸ“¦ Productos ({{ items|length }})</h5>
          
          {% for item in items %}
          <div class="row align-items-center mb-4 pb-4 border-bottom">
            <!-- Imagen del producto -->
            <div class="col-md-2 col-3">
              <img src="{{ item.producto.imagen or url_for('static', filename='img/default.png') }}" 
                   class="img-fluid rounded" 
                   alt="{{ item.producto.nombre }}"
                   style="height: 80px; width: 80px; object-fit: cover;">
            </div>

            <!-- InformaciÃ³n del producto -->
            <div class="col-md-4 col-5">
              <h6 class="fw-bold mb-1">{{ item.producto.nombre }}</h6>
              <p class="text-muted small mb-0">{{ item.producto.descripcion[:50] }}...</p>
            </div>

            <!-- Cantidad -->
            <div class="col-md-2 col-4">
              <div class="text-center">
                <span class="text-muted small d-block mb-1">Cantidad</span>
                <span class="badge bg-primary fs-6">{{ item.cantidad }}</span>
              </div>
            </div>

            <!-- Precio -->
            <div class="col-md-2 col-6 mt-3 mt-md-0">
              <div class="text-center">
                <span class="text-muted small d-block">Precio unit.</span>
                <span class="fw-bold">${{ "%.2f"|format(item.producto.precio) }}</span>
              </div>
            </div>

            <!-- Subtotal y acciones -->
            <div class="col-md-2 col-6 mt-3 mt-md-0">
              <div class="text-center">
                <span class="text-muted small d-block">Subtotal</span>
                <span class="fw-bold h5 mb-2 d-block" style="color: #FF6B9D;">
                  ${{ "%.2f"|format(item.producto.precio * item.cantidad) }}
                </span>
                <a href="{{ url_for('eliminar_item', item_id=item.id) }}" 
                   class="btn btn-sm btn-outline-danger">
                  ğŸ—‘ï¸ Eliminar
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Resumen del pedido -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 sticky-top" style="top: 20px;">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-4">ğŸ’° Resumen del Pedido</h5>
          
          <div class="d-flex justify-content-between mb-3">
            <span class="text-muted">Productos ({{ items|length }})</span>
            <span class="fw-bold">${{ "%.2f"|format(total) }}</span>
          </div>

          <div class="d-flex justify-content-between mb-3">
            <span class="text-muted">EnvÃ­o</span>
            <span class="text-success fw-bold">GRATIS ğŸ‰</span>
          </div>

          <hr class="my-3">

          <div class="d-flex justify-content-between mb-4">
            <span class="h5 fw-bold">Total</span>
            <span class="h4 fw-bold" style="background: linear-gradient(135deg, #FF6B9D 0%, #C084FC 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
              ${{ "%.2f"|format(total) }}
            </span>
          </div>

          <!-- Botones de acciÃ³n -->
          <form method="POST" action="{{ url_for('finalizar_compra') }}" class="mb-3">
            <button type="submit" class="btn btn-success w-100 btn-lg mb-2">
                ğŸ’³ Proceder al Pago
            </button>
          </form>

          <a href="{{ url_for('home') }}" class="btn btn-outline-secondary w-100 mb-2">
            â¬…ï¸ Seguir Comprando
          </a>

          <a href="{{ url_for('vaciar_carrito') }}" class="btn btn-outline-danger w-100">
            ğŸ—‘ï¸ Vaciar Carrito
          </a>

          <!-- InformaciÃ³n adicional -->
          <div class="mt-4 p-3 rounded" style="background: linear-gradient(135deg, #FFF1F2 0%, #FFE4E6 100%);">
            <div class="text-center">
              <div class="mb-2" style="font-size: 2rem;">ğŸ”’</div>
              <p class="small mb-0 fw-bold">Compra 100% Segura</p>
              <p class="small text-muted mb-0">Tus datos estÃ¡n protegidos</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% else %}
  <!-- Carrito vacÃ­o -->
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm border-0 text-center p-5">
        <div class="mb-4" style="font-size: 6rem;">ğŸ›’</div>
        <h3 class="fw-bold mb-3">Tu carrito estÃ¡ vacÃ­o</h3>
        <p class="text-muted mb-4">Â¡Agrega algunos coleccionables increÃ­bles!</p>
        <a href="{{ url_for('home') }}" class="btn btn-primary btn-lg">
          ğŸ›ï¸ Ir a Comprar
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
@media (max-width: 768px) {
  .sticky-top {
    position: relative !important;
  }
}

.card {
  border-radius: 20px;
}

.border-bottom:last-child {
  border-bottom: none !important;
  padding-bottom: 0 !important;
  margin-bottom: 0 !important;
}
</style>
{% endblock %}