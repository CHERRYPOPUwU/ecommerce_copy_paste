{% extends 'base.html' %}
{% block content %}
<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-lg border-0" style="border-radius: 20px;">
        <div class="card-body p-5">
          <div class="text-center mb-4">
            <div style="font-size: 4rem;">üí≥</div>
            <h2 class="fw-bold mt-3">Pago con Tarjeta</h2>
            <p class="text-muted">Ingresa los datos de tu tarjeta</p>
          </div>

          <div class="alert alert-info mb-4">
            <strong>Total a pagar:</strong> 
            <span class="float-end h5 mb-0">${{ "%.2f"|format(pedido.total) }}</span>
          </div>

          <form method="POST">
            <div class="mb-4">
              <label class="form-label fw-bold">N√∫mero de Tarjeta</label>
              <input type="text" 
                     name="numero_tarjeta" 
                     class="form-control form-control-lg" 
                     placeholder="1234 5678 9012 3456"
                     maxlength="16"
                     pattern="[0-9]{16}"
                     required>
              <small class="text-muted">16 d√≠gitos sin espacios</small>
            </div>

            <div class="mb-4">
              <label class="form-label fw-bold">Nombre del Titular</label>
              <input type="text" 
                     name="nombre_titular" 
                     class="form-control form-control-lg" 
                     placeholder="Como aparece en la tarjeta"
                     required>
            </div>

            <div class="row">
              <div class="col-md-6 mb-4">
                <label class="form-label fw-bold">Fecha de Expiraci√≥n</label>
                <input type="text" 
                       name="fecha_expiracion" 
                       class="form-control form-control-lg" 
                       placeholder="MM/AA"
                       pattern="[0-9]{2}/[0-9]{2}"
                       maxlength="5"
                       required>
              </div>
              <div class="col-md-6 mb-4">
                <label class="form-label fw-bold">CVV</label>
                <input type="text" 
                       name="cvv" 
                       class="form-control form-control-lg" 
                       placeholder="123"
                       maxlength="3"
                       pattern="[0-9]{3}"
                       required>
              </div>
            </div>

            <div class="mb-4 p-3 rounded" style="background: linear-gradient(135deg, #FFF1F2 0%, #FFE4E6 100%);">
              <div class="d-flex align-items-center">
                <div style="font-size: 2rem;" class="me-3">üîí</div>
                <div>
                  <small class="fw-bold d-block">Transacci√≥n Segura</small>
                  <small class="text-muted">Tus datos est√°n protegidos con encriptaci√≥n SSL</small>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-success btn-lg w-100 mb-3">
              ‚úÖ Confirmar Pago
            </button>
            <a href="{{ url_for('seleccionar_metodo_pago') }}" class="btn btn-outline-secondary w-100">
              ‚¨ÖÔ∏è Cambiar M√©todo de Pago
            </a>
          </form>

          <div class="text-center mt-4">
            <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" 
                 alt="Visa" style="height: 30px; margin: 0 10px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" 
                 alt="Mastercard" style="height: 30px; margin: 0 10px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg" 
                 alt="Amex" style="height: 30px; margin: 0 10px;">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Auto-formatear n√∫mero de tarjeta
document.querySelector('input[name="numero_tarjeta"]').addEventListener('input', function(e) {
  this.value = this.value.replace(/\D/g, '');
});


// Auto-formatear fecha de expiraci√≥n
document.querySelector('input[name="fecha_expiracion"]').addEventListener('input', function(e) {
  let value = this.value.replace(/\D/g, ''); // <-- usa replace, no replaceALL
  if (value.length >= 2) {
    value = value.slice(0, 2) + '/' + value.slice(2, 4);
  }
  this.value = value;
});

// Solo n√∫meros en CVV
document.querySelector('input[name="cvv"]').addEventListener('input', function(e) {
  this.value = this.value.replace(/\D/g, '');
});

</script>
{% endblock %}